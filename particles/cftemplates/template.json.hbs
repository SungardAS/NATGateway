{{#layout}}

  {{
    parameter "module:particles-common-core" "base"
    logicalId="VpcCidr"
    type="String"
    description="VPC Cidr Block. Format: x.x.x.x/x"
    minLength="9"
    maxLength="18"
    allowedPattern="(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    constraintDescription="must be a valid CIDR range formatted as x.x.x.x/x"
  }}

  {{
    parameter "module:particles-common-core" "base"
    logicalId="PublicCidr"
    type="String"
    description="Public Cidr Block. Format: x.x.x.x/x"
    minLength="9"
    maxLength="18"
    allowedPattern="(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    constraintDescription="must be a valid CIDR range formatted as x.x.x.x/x"
  }}

  {{
    parameter "module:particles-common-core" "base"
    logicalId="PrivateCidr"
    type="String"
    description="Private Cidr Block. Format: x.x.x.x/x"
    minLength="9"
    maxLength="18"
    allowedPattern="(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})"
    constraintDescription="must be a valid CIDR range formatted as x.x.x.x/x"
  }}

  {{
    parameter "module:particles-common-core" "base"
    logicalId="NameTag"
    default="default"
    type="String"
    description="Set the name tag for vpc."
    minLength="1"
    maxLength="255"
    allowedPattern="[\\x20-\\x7E]*"
    constraintDescription="can contain only ASCII characters."
  }}

  {{#resource logicalId="Vpc"}}
    "Type": "AWS::CloudFormation::Stack",
     "Properties": {
      "TemplateURL": "{{templateS3Url 'module:particles-vpc' 'simple/vpc.template.json'}}",
       "Parameters": {
         "VpcCidr": { "Ref": "VpcCidr" },
         "CreateVpcSecurityGroup": "false",
         "OpenVpcCommunication": "false",
         "CreateInternetGateway": "true",
         "NameTag": { "Ref": "NameTag" }
       }
    }
  {{/resource}}

  {{#resource logicalId="PublicSubnet"}}
    "Type": "AWS::CloudFormation::Stack",
     "Properties": {
      "TemplateURL": "{{templateS3Url 'module:particles-vpc' 'simple/subnet.template.json'}}",
       "Parameters": {
         "NameTag": {"Fn::Join": [".", [{"Ref": "NameTag"},"public.subnet"]]},
         "VpcId": {"Fn::GetAtt": [ "Vpc", "Outputs.VpcId" ] },
         "SubnetCidr": { "Ref": "PublicCidr" },
         "RouteTableId": {"Fn::GetAtt": [ "Vpc", "Outputs.RouteTableId" ] }
       }
    }
  {{/resource}}

  {{#resource logicalId="PrivateSubnet"}}
    "Type": "AWS::CloudFormation::Stack",
     "Properties": {
      "TemplateURL": "{{templateS3Url 'module:particles-vpc' 'simple/subnet.template.json'}}",
       "Parameters": {
         "NameTag": {"Fn::Join": [".", [{"Ref": "NameTag"},"private.subnet"]]},
         "VpcId": {"Fn::GetAtt": [ "Vpc", "Outputs.VpcId" ] },
         "SubnetCidr": { "Ref": "PrivateCidr" },
         "RouteTableId": {"Fn::GetAtt": [ "NatGateway", "Outputs.NatRouteTableId" ] },
         "AvailabilityZone": {"Fn::GetAtt": [ "PublicSubnet", "Outputs.AvailabilityZone" ] }
       }
    }
  {{/resource}}

  {{#resource logicalId="NatGateway"}}
    "Type": "AWS::CloudFormation::Stack",
     "Properties": {
      "TemplateURL": "{{templateS3Url 'natgateway.template.json'}}",
       "Parameters": {
         "VpcId": {"Fn::GetAtt": [ "Vpc", "Outputs.VpcId" ] },
         "PublicSubnetId": {"Fn::GetAtt": [ "PublicSubnet", "Outputs.SubnetId" ] }
       }
    }
  {{/resource}}

  {{#output logicalId="PublicSubnetId"}}
    "Value": {"Fn::GetAtt": [ "PublicSubnet", "Outputs.SubnetId" ] }
  {{/output}}

  {{#output logicalId="PublicSubnetAvailabilityZone"}}
    "Value": {"Fn::GetAtt": [ "PublicSubnet", "Outputs.AvailabilityZone" ] }
  {{/output}}

  {{#output logicalId="PrivateSubnetId"}}
    "Value": {"Fn::GetAtt": [ "PrivateSubnet", "Outputs.SubnetId" ] }
  {{/output}}

  {{#output logicalId="PrivateSubnetAvailabilityZone"}}
    "Value": {"Fn::GetAtt": [ "PrivateSubnet", "Outputs.AvailabilityZone" ] }
  {{/output}}

  {{#output logicalId="NatRouteTableId"}}
    "Value": {"Fn::GetAtt": [ "NatGateway", "Outputs.NatRouteTableId" ] }
  {{/output}}

  {{#output logicalId="CustomerRouteTableId"}}
    "Value": {"Fn::GetAtt": [ "Vpc", "Outputs.RouteTableId" ] }
  {{/output}}

  {{#output logicalId="NatGatewayId"}}
    "Value": {"Fn::GetAtt": [ "NatGateway", "Outputs.NatGatewayId" ] }
  {{/output}}

{{/layout}}
